easyblock = 'Bundle'
name = 'Allinea-cpu'
version = '7.1'

homepage = 'http://www.allinea.com'
description = """Profiler and debugger, combining Allinea MAP and Allinea DDT."""

toolchain = {'name': 'dummy', 'version': 'dummy'}

dependencies = [ ('Allinea', '7.1') ]

# Example of templates usage
# templates = [
#    'kebnekaise.qtf',
#    'kebnekaise-gpu.qtf',
# ]

# Example of sysconfig usage
# sysconfig = 'system.config.hpc2n'

moduleclass = 'tools'

modluafooter = """
require("SitePackage")
local found = find_and_define_license_file("ALLINEA_LICENSE_FILE","allinea-cpu")
if (not found) then
	local error_message = [[

	We did not find a suitable license for Allinea Forge. If you think this should not be correct, please contact technical support.

	Nous n'avons pas trouve de licence utilisable pour Allinea Forge. Si vous croyez qu'une licence devrait etre disponible, veuillez contacter le soutien technique.
	]]
	LmodError(error_message)
end

if isloaded("openmpi/2.1.1") then
	local error_message = [[

	OpenMPI 2.1.1 is not compatible with Allinea Forge, please try 'module load openmpi/2.0.2'.
	OpenMPI 2.1.1 n'est pas compatible avec Allinea Forge , veuillez essayer 'module load openmpi/2.0.2'.
	https://github.com/open-mpi/ompi/issues/3660
	]]
	LmodError(error_message)
end

add_property("type_","tools")

family("allinea")
"""
