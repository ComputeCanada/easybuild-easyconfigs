easyblock = 'Tarball'

name = 'CellRanger'
version = '4.0.0'

homepage = 'https://support.10xgenomics.com/single-cell-gene-expression/software/overview/welcome'
description = """Cell Ranger is a set of analysis pipelines that process Chromium single cell 3-RNA-seq output to align reads, generate gene-cell matrices and perform clustering and gene expression analysis. Cell Ranger 1.2 and later support libraries generated by the Chromium Single Cell 3i-v1 and v2 reagent kits, whereas Cell Ranger 1.1 and earlier do not support v2 libraries.

 Cell Ranger includes four main gene expression pipelines:
 - cellranger mkfastq wraps Illumina's bcl2fastq to correctly demultiplex Chromium-prepared sequencing samples and to convert barcode and read data to FASTQ files.
 - cellranger count takes FASTQ files from cellranger mkfastq and performs alignment, filtering, and UMI counting.
 - cellranger aggr aggregates outputs from multiple runs of cellranger count, normalizing those runs to the same sequencing depth and then recomputing the gene-barcode matrices and analysis on the combined data.
 - cellranger reanalyze takes gene-barcode matrices produced by cellranger count or cellranger aggr and reruns the dimensionality reduction, clustering, and gene expression algorithms using tunable parameter settings.

These pipelines combine Chromium-specific algorithms with the widely used RNA-seq aligner STAR. Output is delivered in standard BAM, MEX, CSV, HDF5 and HTML formats that are augmented with cellular information."""

toolchain = {'name': 'system', 'version': ''}

# Need to manually download after reading and accepting the license:
# https://support.10xgenomics.com/single-cell-gene-expression/software/downloads/latest
 
source_urls = ['https://support.10xgenomics.com/single-cell-gene-expression/software/downloads/latest']
sources = ['%(namelower)s-%(version)s.tar.gz']
checksums = ['e8e43e91538cba667836d437ac1d5ca675ea9d1acd977ac967f7b65c12254a21']

keepsymlinks = True

sanity_check_paths = {
    'files': ['cellranger', 'sourceme.bash', 'sourceme.csh', 'builtwith.json'],
    'dirs': ['bin', 'external', 'lib', 'mro', 'target_panels'],
}

postinstallcmds = ["chmod -R go+X %(installdir)s"]

modloadmsg = """ To initialize CellRanger,

  do:
       source $EBROOTCELLRANGER/sourceme.bash

"""

moduleclass = 'bio'
