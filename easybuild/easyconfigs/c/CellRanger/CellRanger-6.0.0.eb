# The STAR binary included in this version has been vectorized with AVX
# hence it is not recommended for systems that do not support it.

easyblock = 'Tarball'

name = 'CellRanger'
version = '6.0.0'

homepage = 'https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/what-is-cell-ranger'
description = """Cell Ranger is a set of analysis pipelines that process Chromium single cell 3-RNA-seq output to align reads, generate gene-cell matrices and perform clustering and gene expression analysis. Cell Ranger 1.2 and later support libraries generated by the Chromium Single Cell 3i-v1 and v2 reagent kits, whereas Cell Ranger 1.1 and earlier do not support v2 libraries.

Cell Ranger includes four main gene expression pipelines:
 - cellranger mkfastq wraps Illumina's bcl2fastq to correctly demultiplex Chromium-prepared sequencing samples and to convert barcode and read data to FASTQ files.
 - cellranger count takes FASTQ files from cellranger mkfastq and performs alignment, filtering, and UMI counting.
 - cellranger aggr aggregates outputs from multiple runs of cellranger count, normalizing those runs to the same sequencing depth and then recomputing the gene-barcode matrices and analysis on the combined data.
 - cellranger reanalyze takes gene-barcode matrices produced by cellranger count or cellranger aggr and reruns the dimensionality reduction, clustering, and gene expression algorithms using tunable parameter settings.

These pipelines combine Chromium-specific algorithms with the widely used RNA-seq aligner STAR. Output is delivered in standard BAM, MEX, CSV, HDF5 and HTML formats that are augmented with cellular information."""

toolchain = SYSTEM

# Download manually from https://support.10xgenomics.com/single-cell-gene-expression/software/downloads/latest
 
source_urls = ['https://support.10xgenomics.com/single-cell-gene-expression/software/downloads/latest']
sources = [SOURCELOWER_TAR_GZ]
checksums = ['c8f5c8388790248cccb9efe991a098de8c82fd3cccf8c80cd5a94d1748ff2fdb']

keepsymlinks = True

sanity_check_paths = {
    'files': ['cellranger', 'sourceme.bash', 'sourceme.csh', 'builtwith.json'],
    'dirs': ['bin', 'external', 'lib', 'mro', 'target_panels'],
}
sanity_check_commands = ['cellranger testrun --id=tiny']

postinstallcmds = ["chmod -R go+X %(installdir)s"]

modloadmsg = """ To initialize CellRanger,

  do:
       source $EBROOTCELLRANGER/sourceme.bash

"""

moduleclass = 'bio'
